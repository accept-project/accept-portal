

@{
    ViewBag.Title = @AcceptPortal.Resources.Global.EvaluationDemo;
}

<h2>@AcceptPortal.Resources.Global.EvaluationDemo</h2>

<div class="headerApps">
    @*<table border="0">
    <tr>
    <td><a href="@Url.Action("Index", "Evaluation")">@AcceptPortal.Resources.Global.EvaluationManagement</a></td>
    <td><a href="@Url.Action("Demo", "Evaluation")">@AcceptPortal.Resources.Global.EvaluationDemo</a></td>
    </tr>
    </table>*@
    
    <ul class="horizontal-slide">
        <li><a class="underline-over" href="@Url.Action("Index", "Evaluation")">@AcceptPortal.Resources.Global.EvaluationManagement</a></li>
        <li><a class="underline-over" href="@Url.Action("Demo", "Evaluation")">@AcceptPortal.Resources.Global.EvaluationDemo</a></li>   
        <li><a class="underline-over" href="@Url.Action("DemoMetrics", "Evaluation")">@AcceptPortal.Resources.Global.EvaluationViewDemoMetrics</a></li>   
   </ul>
    </div>

<p>@AcceptPortal.Resources.Global.EvaluationDemoOverview</p>

<table border="0">
	<tr>
	<td>
	<div class="lia-message-view message-uid-147" id="messageview">
		<table border=1>
		<tr>
		<td width="200">
			<div name="voting" />
		</td>
		<td>
			<div class="content-source">
			This is a test sentence!
			</div>
		</td>
		<td>
			<div class="content-mt">
			    C'est une test phrase!
			</div>
		</td>
		</tr>
		</table>
	</div>
	</td>
	</tr>
	<tr>
	<td>
	<div class="lia-message-view message-uid-148" id="messageview">
		<table border=1>
		<tr>
		<td width="200">
			<div name="voting" />
		</td>
		<td>
			<a shape="rect" name="U148"> </a>
			<div class="content-source">
			This is another test sentence!
			</div>
		</td>
		<td>
			<div class="content-mt">
			C'est une autre test phrase!
			</div>
		</td>
		</tr>
		</table>
	</div>
	</td>
	</tr>
</table>

@section scripts{
<script type="text/javascript" language="javascript">
    $(document).ready(function () {    
        $.ajax({
            url: 'http://www.accept-portal.com/AcceptApi/api/v1/Evaluation/Questions/3?key=2401978f68924cef903ec5f8a0f70a9d&language=en_us&category=3&question=5',
            contentType: "application/json",
            type: "GET",
            async: false,
            cache: false,
            dataType: 'jsonp',
            success: function (data)
            {
                var text = '';
                var q = data.ResponseObject[0];


                for (var i = 0; i < q.LanguageQuestions.length; i++) {
                    question = q.LanguageQuestions[i].Question;
                    questionId = q.LanguageQuestions[i].Id;
                    language = q.LanguageQuestions[i].Language.Code;
                    languageid = q.LanguageQuestions[i].Language.Id
                    action = q.LanguageQuestions[i].Action;

                    $("div[class^='lia-message-view message-uid-']").each(function () {
                        var id = $(this).attr("class");
                        var PostID = $(this).attr("class").replace("lia-message-view message-uid-", "");
                        var frmName = "voting_" + PostID; //+ q.LanguageQuestions[i].Id;

                        text = '<form id="' + frmName + '"><table border=1><tr><td bgcolor=lightgray><b>' + question + '</b></td></tr>';
                        text += '<tr><td><div id="voteoptions">';

                        for (var x = 0; x < q.LanguageQuestions[i].Answers.length; x++) {
                            answer = q.LanguageQuestions[i].Answers[x];
                            if (x == 0)
                                text += '<input id="radioCount_' + answer.Id + '" type="radio" name="choice" value="' + answer.Id + '" checked>' + answer.Name;
                            else
                                text += '<input id="radioCount_' + answer.Id + '" type="radio" name="choice" value="' + answer.Id + '">' + answer.Name;

                        }

                        text += '<br/>';
                        text += '<input  value="' + action + '" type="button" onclick="SubmitVote(\'' + frmName + '\');" />';
                        text += '</div>';
                        text += '<div id="voteresult" style="display:none">';
                        text += '<font color="green">' + q.LanguageQuestions[i].Confirmation + '</font>';
                        text += '</div>';
                        text += '</td></tr>';
                        text += '</table></form>';

                        $(this).find('div[name="voting"]').html(text);
                        //break;


                    });
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert(errorThrown);
            }
        });

    });

    function SubmitVote(frmName) {
        debugger;
        var PostID = frmName.replace("voting_", "")
        $('#' + frmName + " input:radio").each(function () {
            if ($(this).is(':checked')) {
                var answerID = $(this).val();
                $.ajax({
                    url: 'http://www.accept-portal.com/AcceptApi/Api/v1/Evaluation/Score/3',
                    dataType: 'json',
                    contentType: "application/json",
                    type: 'post',
                    data: '{ "key": "2401978f68924cef903ec5f8a0f70a9d", "answer": ' + answerID + ', "param1": ' + PostID + '  }',
                    success: function (e) {
                        $('#' + frmName).find('#voteoptions').css("display", "none");
                        $('#' + frmName).find('#voteresult').css("display", "block");
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        //alert(errorThrown);
                    }
                });
            }
        });
    }



</script>

    }